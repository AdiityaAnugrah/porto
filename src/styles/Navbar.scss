/* ===========================
   Navbar — MOBILE / TABLET / DESKTOP
   iOS26 glass hanya untuk tombol (burger, theme, drawer items)
   =========================== */

/* ==== iOS 26 glass mixins (for buttons only) ==== */
:root {
  --ios26-noise-alpha: .06;
  --ios26-blur: 14px;
  --ios26-saturate: 140%;
  --ios26-surface-alpha: 24%;
  --ios26-stroke-alpha: 22%;
  --ios26-highlight-alpha: 12%;
  --ios26-elev: 0.9;
}
@function _ios26-noise() {
  @return
    repeating-linear-gradient(0deg,  rgba(255,255,255,var(--ios26-noise-alpha)) 0 1px, rgba(255,255,255,0) 1px 2px),
    repeating-linear-gradient(90deg, rgba(0,0,0,var(--ios26-noise-alpha)) 0 1px,  rgba(0,0,0,0) 1px 2px);
}
@mixin ios26-stroke() {
  border: 1px solid color-mix(in oklab, var(--color-primary) var(--ios26-stroke-alpha), var(--color-border));
}
@mixin ios26-fill($alpha: var(--ios26-surface-alpha)) {
  background:
    radial-gradient(120% 80% at 50% -10%, color-mix(in oklab, #fff var(--ios26-highlight-alpha), transparent) 0%, transparent 60%),
    linear-gradient(180deg, color-mix(in oklab, var(--color-primary) 14%, transparent) 0%, color-mix(in oklab, var(--color-primary) 8%, transparent) 100%),
    color-mix(in oklab, var(--color-surface) $alpha, transparent);
}
@mixin ios26-shadow($elev: var(--ios26-elev)) {
  box-shadow:
    0 calc(6px * #{$elev}) calc(16px * #{$elev}) rgba(0,0,0,.08),
    0 calc(10px * #{$elev}) calc(26px * #{$elev}) rgba(0,0,0,.06);
}
@mixin glass-ios26($blur: var(--ios26-blur)) {
  @include ios26-stroke(); @include ios26-fill(); @include ios26-shadow();
  -webkit-backdrop-filter: blur($blur) saturate(var(--ios26-saturate));
          backdrop-filter: blur($blur) saturate(var(--ios26-saturate));
  position: relative; overflow: hidden;
  &::after { content: ""; position: absolute; inset: 0; pointer-events: none; background: _ios26-noise(); mix-blend-mode: overlay; opacity: .4; }
}

/* ==== BASE ==== */
.navbar {
  --nav-h: clamp(54px, 8vh, 64px);

  position: sticky; top: 0; z-index: 1000;
  background: var(--color-surface);
  color: var(--color-text);
  border-bottom: 1px solid var(--color-border);
  box-shadow: 0 2px 8px rgba(0,0,0,0.06);
  backdrop-filter: saturate(140%) blur(6px);

  .navbar__inner {
    min-height: var(--nav-h);
    max-width: 1120px;
    margin: 0 auto;
    padding: 0 clamp(0.65rem, 2vw, 2rem);
    display: flex; align-items: center; justify-content: space-between; gap: 10px;
  }

  .navbar-brand {
    .brand-link {
      display: inline-flex; align-items: center; gap: .5rem;
      font-size: clamp(1.05rem, 2.2vw, 1.45rem);
      font-weight: 700; color: var(--color-text); text-decoration: none;
      &:focus-visible { outline: 2px solid var(--color-primary); outline-offset: 3px; border-radius: 10px; }
    }
    .navbar-logo {
      width: clamp(26px, 4.2vw, 38px); height: clamp(26px, 4.2vw, 38px);
      object-fit: contain; border-radius: 8px; background: transparent;
      box-shadow: 0 6px 18px rgba(0,0,0,.08);
    }
  }

  /* desktop/tablet inline links */
  .navbar-links.desktop {
    display: flex; align-items: center; gap: clamp(.6rem, 2vw, 1.3rem);
    list-style: none; margin-left: auto; padding: 0;

    > li {
      position: relative;

      > a {
        display: inline-flex; align-items: center; gap: .35rem;
        padding: .45rem .35rem; color: var(--color-text);
        text-decoration: none; font-weight: 600; font-size: .93rem; transition: color .2s ease;

        &::after {
          content: ""; display: block; height: 2px; transform: scaleX(0);
          transform-origin: left; background: var(--color-primary);
          transition: transform .2s ease; margin-top: 4px;
        }
        &:hover, &.active { color: var(--color-primary); }
        &:hover::after, &.active::after { transform: scaleX(1); }

        .chevron { font-size: 10px; opacity: .75; transition: transform .18s ease; }
      }

      /* Desktop hover */
      @media (hover: hover) and (pointer: fine) and (min-width: 1025px) {
        &.has-submenu:hover .submenu,
        &.has-submenu:focus-within .submenu {
          opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto;
        }
      }

      /* Tablet click-open (class .open dari JS) */
      &.open > a .chevron { transform: rotate(180deg); }

      .submenu {
        position: absolute;
        top: calc(100% + 8px);
        left: 0;
        min-width: 200px;
        background: var(--color-surface);
        list-style: none;
        margin: 0; padding: .5rem;
        border: 1px solid var(--color-border);
        border-radius: 10px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.12);
        opacity: 0; visibility: hidden; transform: translateY(-6px);
        transition: all .18s ease;
        pointer-events: none;
        z-index: 60;

        li a {
          display: block;
          padding: .5rem .7rem;
          color: var(--color-text);
          text-decoration: none;
          font-weight: 500;
          border-radius: 8px;
          &:hover, &.active {
            color: var(--color-primary);
            background: color-mix(in oklab, var(--color-border) 18%, transparent);
          }
        }
      }
    }
  }

  /* Buttons with iOS 26 glass */
  .navbar-toggle,
  .theme-toggle {
    display: none; /* controlled by breakpoints */
    height: 38px; width: 38px; border-radius: 12px;
    font-size: 1.05rem; cursor: pointer; color: var(--color-text);
    @include glass-ios26(14px);
    display: inline-flex; align-items: center; justify-content: center;
    &:hover { filter: brightness(1.04); }
  }
  .theme-toggle { margin-left: .4rem; }

  /* Drawer (mobile only) */
  .mobile-drawer {
    position: fixed; top: var(--nav-h); left: 0; right: 0; bottom: 0;
    background: var(--color-surface);
    border-top: 1px solid var(--color-border);
    transform: translateY(-8px);
    opacity: 0; pointer-events: none;
    transition: transform .18s ease, opacity .18s ease;
    padding-top: max(0px, env(safe-area-inset-top));
    z-index: 999;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: contain;

    &.open { transform: translateY(0); opacity: 1; pointer-events: auto; }
  }
  .navbar-links.mobile {
    list-style: none; margin: 0; padding: 10px;
    max-width: 1120px; width: 100%; margin-inline: auto;
    display: grid; gap: 8px;

    li { width: 100%; }

    a, .submenu-toggle {
      width: 100%; text-align: left;
      padding: 12px 14px; border-radius: 12px; font-weight: 600;
      display: inline-flex; align-items: center; justify-content: space-between; gap: 10px;
      color: var(--color-text); text-decoration: none;
      @include glass-ios26(14px);
      &:hover, &.active { color: var(--color-primary); }
      .chevron { opacity: .7; transition: transform .18s ease; }
      &[aria-expanded="true"] .chevron { transform: rotate(180deg); }
    }

    .has-submenu .submenu {
      margin-top: 6px; display: none; padding-left: 6px; list-style: none;
      &.open { display: grid; gap: 6px; }
      a {
        padding: 10px 12px; border-radius: 10px; font-weight: 500;
        @include glass-ios26(12px);
        &.active { color: var(--color-primary); }
      }
    }

    .mobile-theme-toggle {
      margin-top: 4px;
      button {
        width: 100%; padding: 12px 14px; border-radius: 12px; font-weight: 600;
        display: inline-flex; align-items: center; gap: 10px; color: var(--color-text);
        @include glass-ios26(12px);
      }
    }
  }

  /* ======================
     BREAKPOINTS
     ====================== */

  /* MOBILE ≤639px: Drawer aktif */
  @media (max-width: 639px) {
    --nav-h: 54px;
    .navbar__inner { padding-inline: .6rem; }
    .navbar-brand .brand-link { font-size: 1.05rem; }
    .navbar-logo { width: 26px; height: 26px; }

    .navbar-links.desktop { display: none; }
    .theme-toggle { display: none; }          /* pindah ke drawer */
    .navbar-toggle { display: inline-flex; margin-left: auto; height: 36px; width: 36px; font-size: 1rem; }

    .mobile-drawer { display: block; }
    .navbar-links.mobile {
      grid-template-columns: 1fr;
      a, .submenu-toggle { padding: 11px 12px; border-radius: 12px; }
    }
  }

  /* TABLET 640–1024px: Inline menu + tap-to-open submenu, tanpa drawer */
  @media (min-width: 640px) and (max-width: 1024px) {
    --nav-h: 60px;
    .navbar__inner { padding-inline: .9rem; }
    .navbar-brand .brand-link { font-size: 1.18rem; }
    .navbar-logo { width: 32px; height: 32px; }

    .navbar-links.desktop { display: flex; gap: 1rem; }
    .navbar-links.desktop > li > a { padding: .5rem .4rem; font-size: .92rem; }

    /* tampilkan theme toggle; sembunyikan burger; matikan drawer */
    .theme-toggle { display: inline-flex; }
    .navbar-toggle { display: none; }
    .mobile-drawer { display: none !important; }

    /* buka submenu saat item .open (dari state) */
    .navbar-links.desktop > li.open > .submenu {
      opacity: 1; visibility: visible; transform: translateY(0); pointer-events: auto;
    }

    /* sentuhan: perbesar target */
    .navbar-links.desktop .submenu li a { padding: .6rem .8rem; }
  }

  /* DESKTOP ≥1025px: Inline + hover submenu */
  @media (min-width: 1025px) {
    --nav-h: 64px;
    .navbar__inner { padding-inline: 1.2rem; }
    .navbar-links.desktop { display: flex; }
    .theme-toggle { display: inline-flex; }
    .navbar-toggle { display: none; }
    .mobile-drawer { display: none; }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    * { transition: none !important; }
    .navbar-toggle, .theme-toggle,
    .navbar-links.mobile a, .navbar-links.mobile .submenu-toggle { box-shadow: none; }
  }
}
